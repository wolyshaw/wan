/** * Created by wolyshaw on 15/11/4. */var express = require('express');var path = require('path');var wan = require('./schemas/wan');var port = process.env.PORT || 3000;var app = express();app.use(express.static('public'));var bodyParser = require('body-parser');app.use(bodyParser.json());app.use(bodyParser.urlencoded({ extended: true }));app.set('views', './views');app.set('view engine', 'jade');app.listen(port);console.log('run on port : ' + port);app.get('/', function(req, res){  var sql =  'SELECT * FROM `test3` ORDER BY `id` DESC';  wan.getData(sql,function(err, item){    res.render('index', {      title: 'nodeJs',      data:item    })  });});app.get('/upload', function(req, res){    res.render('up', {      title: '上传'      // data:item    })});app.get('/p/:id', function(req, res){  var id = req.params.id;  var sql =  'SELECT * FROM `test3` WHERE `id` = '+id;  wan.getData(sql,function(err, item){    res.render('post', {      title: 'p'+id,      data : item    })  });});app.get('/account', function(req, res){  res.render('account', {    title: '账户'  })});app.get('/account/weibo/callback', function(req, res){  var code = req.query.code;  exports.sendEmail = function (req, res) {    var data = {      client_id: '1513304106',      client_secret: "f64c963888a7af3b79e77a92b9649ab2",      grant_type: "authorization_code",      redirect_uri: "http://wan.gouwulun.com/?2",      code: code    };    data = JSON.stringify(data);    console.log(data);    var opt = {      method: "POST",      host: "api.weibo.com",      port: 443,      path: "/oauth2/access_token",      headers: {        "Content-Type": 'application/json',        "Content-Length": data.length      }    };    var req = http.request(opt, function (serverFeedback) {      if (serverFeedback.statusCode == 200) {        var body = "";        serverFeedback.on('data', function (data) { body += data; })          .on('end', function () { res.send(200, body); });      }      else {        res.send(500, "error");      }    });    req.write(data + "\n");    req.end();  }});app.post('/content/new', function(req, res) {  wan.upData(req, res);  res.send(req.body);});