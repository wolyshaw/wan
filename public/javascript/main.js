/** * Created by wolyshaw on 15/11/6. */// 点击获取当前样式$(function(){  $('.userMeun li').click(function(){    $(this).siblings().removeClass('userOn');    $(this).addClass('userOn');  })});// Ajax获取上传表单$('.upBtn').one('click',function(){  $.ajax({    method:'GET',    url:'/upload',    success:function(data){      $('.con').append($(data).find('.upForm'))    }  })}).click(function(){  $('.likeList').fadeOut(200);  $('.upForm').fadeIn(200);});$('.likeBtn').click(function(){  $('.likeList').fadeIn(200);  $('.upForm').fadeOut(200);});// Ajax上传数据function qiniuForm(){  var _form = $('<form method="post" action="http://upload.qiniu.com/" enctype="multipart/form-data"' +    ' class="qiniuForm">'+    '<input name="x:<custom_name>" type="hidden" value="<custom_value>">'+    '<input name="token" type="hidden" value="<upload_token>" class="token">'+    '<input name="key" type="hidden" value="<resource_key>" class="qiniuKey">'+    '<label for="fileBtn" class="fileLab btn">选择一个文件</label>'+    '<input name="file" type="file" class="fileBtn" id="fileBtn" >'+    '<input name="accept" type="hidden" >'+    '<input type="submit" value="提交" class="qiniuSub btn" >'+    '</form>')  return _form;}function qiniuLoad(){  var _load = $('<div class="upLoad none">'+    '<div class="sk-three-bounce">'+    '<div class="sk-child sk-bounce1"></div>'+    '<div class="sk-child sk-bounce2"></div>'+    '<div class="sk-child sk-bounce3"></div>'+    '</div>'+    '<div class="docs"></div>'+    '</div>')  return _load;}// 配置需要的信息var urlDate=new Date();var buckName = 'myfile' ;var domain   = 'http://7xnb28.com1.z0.glb.clouddn.com/' ;var tokenUrl = 'http://gouwulun.com/token/uptoken.php?buckName=' +buckName ;var postUrl  = 'http://upload.qiniu.com/' ;console.log(domain)function getToken() {  // 获取文件数据并赋值给token,并且加载form插件  $.ajax({    url: tokenUrl,    cache: false  }).done(function(data) {    $('.token').val(data)  });  $('body').append($('<script src="//cdn.bootcss.com/jquery.form/3.51/jquery.form.min.js?ver=15.10.9"></script>'))}$('body').on('click', '.pushData', function(){  console.log(1);  return false;}).on('click', '.moreFile', function(){  $('.bg').fadeIn(200);  return false;}).on('change', '.fileBtn', function (){  // 获取文件名称并赋值给key  var key = urlDate.getFullYear()+'/'+(urlDate.getUTCMonth()+1)+'/'+fileBtn.value.split(/(\\|\/)/g).pop() ;  $('.qiniuKey').val(key) ;  $('.fileLab').html(key) ;  console.log(key) ;  getToken() ;}).on('click', '.qiniuSub', function(){  $('.qiniuForm').ajaxSubmit({    url: postUrl,    type: 'post',    resetForm: true,    dataType: 'json',    beforeSend: function() {      // 开始上传显示动画      $('.upLoad').removeClass('none');      $('.docs').html('正在准备上传...')    },    uploadProgress: function(event, position, total, percentComplete) {      // 上传过程中      var percentVal = percentComplete + '%'; //获得进度      var datalin = (total/1048576).toFixed(2) + 'MB';      var netlin = ((total/1048576)-(position/1048576)).toFixed(2) + 'MB';      $('.docs').html('已上传 ' + percentVal + ' ,该文件共 ' + datalin + ' ,还剩余 ' + netlin)    },    success:function(data) {      //提交成功后调用      $('.upLoad').addClass('none');      $('.docs').html('');      $('.fileBtn').val('');      $('.fileLab').html('选择一个文件');      console.log(data);      setTimeout(function(){        $('.bg').fadeOut(200);      }, 1000);      $('.linkForm').val(domain + data.key )    }  });  return false;}).one('click', '.moreFile', function (){  var _bg = '<div class="bg"></div>';  var _html = qiniuForm();  $('body').append($(_bg));  $('.bg').append(_html).append(qiniuLoad());});$('.weiboLogin').click(function(){  //if( window.opener ) {window.opener.location.reload();  //  window.close();  //}else{  //  window.location.href = "/";  //}  var myWindow = window.open('/','','width=600,height=480')  //window.opener.location.reload();  if( myWindow.opener ) {    myWindow.opener.location.reload();    myWindow.close();  }else{    myWindow.location.href = "/";  }})//document.getElementsByClassName('weiboLogin')[0].onclick = function(){//  console.log(window.opener.location.reload())//}